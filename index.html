<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Menu Header</title>

<style>
/* ===== BASE ===== */
body{
  margin:0;
  font-family: Arial, sans-serif;
  background:#f4f4f4;
}
select,button{
  font-family:inherit;
  font-size:12px;
  size: 10px;
  box-sizing:border-box;
}
input[type="number"]{
  font-family:inherit;
  font-size:12px;
  width: 80px;
  box-sizing:border-box;
  border: 1px solid #b00020;
  border-radius: 5px;
}

table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
}

th,td{
  border:1px solid #ddd;
  padding:12px;
  vertical-align:middle;
}

/* ===== HEADER ===== */
header{
  text-align:center;
}

#headerName{ margin:0; font-size:22px; }
#headerAddress,
#headerPhone,
#headerDealsIn{
  margin:4px 0;
  font-size:14px;
}

/* ===== IMAGES ===== */
.thumbnail{
  width:140px;
  height:140px;
  margin:auto;
  background:#f9f9f9;
  border-radius:8px;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
}

.thumbnail img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.thumb-overlay{
  position:absolute;
  top:6px;
  right:6px;
  background:rgba(0,0,0,0.6);
  color:#fff;
  padding:4px 6px;
  border-radius:4px;
  font-size:12px;
  cursor:pointer;
  display:none;
}

.thumbnail.has-image:hover .thumb-overlay{
  display:block;
}

/* ===== UPLOAD ===== */
input[type="file"]{ display:none; }

.custom-file-upload{
  margin-top:8px;
  display:inline-block;
  padding:8px 14px;
  background:#007bff;
  color:#fff;
  border-radius:5px;
  cursor:pointer;
  font-weight:600;
}

.custom-file-upload:hover{
  background:#0056b3;
}

#selectedFiles{
  margin-top:6px;
  font-size:13px;
  color:#555;
}

/* ===== CONTROLS ===== */
#controls{
  text-align:center;
  padding:12px;
}

select,button{
  padding:6px 10px;
  border-radius:4px;
  border:1px solid #ccc;
}

button{
  background:#28a745;
  color:#fff;
  border:none;
  cursor:pointer;
}

button:hover{
  background:#218838;
}

/* ===== PRINT ===== */
@media print{
  button,.custom-file-upload,select{ display:none!important; }
  body{ background:#fff; }
}
</style>
<!-- html2canvas and jsPDF (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>
<div id="exportArea" class="export-area">
    <div class="table-responsive">
      <table id="itemTable" role="table" aria-label="Inventory">
       <!-- LEFT IMAGE -->
       <td style="width:160px;text-align:center;">
        <div class="thumbnail">
        <img src="chef.jpg" alt="Chef">
    </div>
      </td>

  <!-- HEADER -->
      <th colspan="2">
     <header>
      <h3 id="headerName">STARTER FACTORY</h3>
      <p id="headerAddress">Old Berhampur, Radhakanta Street, Berhampur</p>
      <p id="headerPhone">üìû 9938618356 | 9658216341</p>
      <p id="headerDealsIn">Deals in: Starters, Chinese, Tandoori, South Indian, Pendir</p>
      <h2><u id="menuTitle">Menu</u></h2>
    </header>
  </th>

  <!-- RIGHT IMAGE UPLOAD -->
  <td style="width:180px;text-align:center;">
    <input type="file" id="imageUpload" accept="image/*">
    <div id="imagePreview" class="thumbnail">
      <span class="thumb-overlay" id="resetImg">Reset</span>
    </div>
    <label for="imageUpload" class="custom-file-upload">Upload Image</label>
    <div id="selectedFiles">No image</div>
  </td>
</tr>
<tr>
  <th>Item Name</th>
  <th>Quantity</th>
  <th>Item</th>
  <th>Quantity</th>
</tr>
<tbody>
        <tr>
          <th colspan="2"><strong>Masala</strong></th>
          <th colspan="2"><strong>Sauce</strong></th>
        </tr>
          <!-- existing items converted to rows -->
          <tr>
            <td>Tomato Ketchup</td>
            <td class="row-actions"><input type="number" min="0" placeholder="Quantity" style="font-size:12px;"><button onclick="removeRow(this)" class="btn ghost1"><span style='font-size:8px;'>&#935;</span></button></td>
            <td>Tomato Ketchup</td>
            <td class="row-actions"><input type="number" min="0" placeholder="Quantity" style="font-size:15px;"><button onclick="removeRow(this)" class="btn ghost2"><span style='font-size:8px;'>&#935;</span></button></td>
          </tr>
           <tr>
          <th></th>
          <th colspan="2" style="text-align:center;font-size:0.9rem;color:#555;"><strong>Thank You for Visiting.</strong></th>
          <th></th>
       </tr>
       <tr>
          <th colspan="2"></th>
          <th colspan="2"><strong>Made By <sub>www.NoteMenu.com</sub></strong></th>
          
       </tr>
          <!-- keep the rest simple: user can add new rows -->
        </tbody>
</table>
</div></div>  

<div class="wrap">
  <table>
  <h2>Inventory Table</h2>

  <div class="controls" aria-hidden="false">
    <tr>
      <th>
        <select id="categorySelect">
          <option value="">Select Category</option>
          <option value="Masala">Masala</option>
          <option value="Sauce">Sauce</option>
        </select>
        <input id="newItemName" type="text" placeholder="Enter Item name" aria-describedby="nameError" inputmode="text" autocomplete="off">
        <input id="newItemQty" type="number" placeholder="Quantity" place-holder="Quantity" min="0">
        <div id="nameError" style="color:#b00020;font-size:0.9rem;display:none;margin-left:8px" role="alert" aria-live="polite"></div>
      </th>
      <th>
        <button class="btn" id="addBtn">Add item</button>
        <button class="btn ghost1" id="clearBtn">Clear inputs</button>
        <div id="nameError" style="color:#b00020;font-size:0.9rem;display:none;margin-left:8px" role="alert" aria-live="polite"></div>
      </th>
   <th>
      <div style="margin-left:auto;display:flex;gap:8px">
      <button class="btn" id="exportPng">Export PNG</button>
      <button class="btn" id="exportPdf">Export PDF</button>
      <button class="btn ghost" id="saveTxt">Save TXT</button>
  </th>
       </tr>
    </div>
  </div>
</table>
<!-- CONTROLS -->
<div id="controls">
  <button onclick="window.print()">Print Menu</button>
  &nbsp;
  <select id="langSelect">
    <option value="en">English</option>
    <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
    <option value="or">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü</option>
  </select>
</div>
<script>
/* ===== IMAGE UPLOAD ===== */
const upload=document.getElementById("imageUpload");
const preview=document.getElementById("imagePreview");
const reset=document.getElementById("resetImg");
const filesText=document.getElementById("selectedFiles");

upload.addEventListener("change",()=>{
  const file=upload.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=e=>{
    preview.innerHTML='<img src="'+e.target.result+'">';
    preview.classList.add("has-image");
    preview.appendChild(reset);
    filesText.textContent=file.name;
  };
  reader.readAsDataURL(file);
});

reset.onclick=()=>{
  preview.innerHTML="";
  preview.classList.remove("has-image");
  preview.appendChild(reset);
  upload.value="";
  filesText.textContent="No image";
};
 // Helpers
  const tbody = document.querySelector('#itemTable tbody');
  const addBtn = document.getElementById('addBtn');
  const clearBtn = document.getElementById('clearBtn');
  const exportPng = document.getElementById('exportPng');
  const exportPdf = document.getElementById('exportPdf');
  const saveTxt = document.getElementById('saveTxt');

  addBtn.addEventListener('click', ()=>{
    const category = document.getElementById('categorySelect').value;
    const name = document.getElementById('newItemName').value.trim();
    const qty = document.getElementById('newItemQty').value;
    if(!category){alert('Select a category'); return;}
    if(!name){alert('Enter an item name'); return;}
    
    // Find the category row
    const categoryRow = findCategoryRow(category);
    if (!categoryRow) {
      alert('Category not found');
      return;
    }
    
    // Add item row after category row, in the appropriate columns
    const itemRow = document.createElement('tr');
    if (category === 'Masala') {
      itemRow.innerHTML = `<td>${escapeHtml(name)}</td><td class="row-actions"><input type="number" value="${Number(qty)||0}" min="0"><button onclick="removeRow(this)" class="btn ghost">Remove</button></td>`;
    } else if (category === 'Sauce') {
      itemRow.innerHTML = `<td></td><td></td><td>${escapeHtml(name)}</td><td class="row-actions"><input type="number" value="${Number(qty)||0}" min="0"><button onclick="removeRow(this)" class="btn ghost">Remove</button></td>`;
    }
    categoryRow.insertAdjacentElement('afterend', itemRow);
    
    document.getElementById('categorySelect').value = '';
    document.getElementById('newItemName').value = '';
    document.getElementById('newItemQty').value = 0;
  });

  function findCategoryRow(category) {
    const rows = document.querySelectorAll('#itemTable tr');
    for (let row of rows) {
      const ths = row.querySelectorAll('th');
      for (let th of ths) {
        if (th.innerText.trim() === category) {
          return row;
        }
      }
    }
    return null;
  }

  clearBtn.addEventListener('click', ()=>{document.getElementById('categorySelect').value='';document.getElementById('newItemName').value='';document.getElementById('newItemQty').value=0});

  function removeRow(btn){
    const td = btn.closest('td');
    const tr = td.closest('tr');
    const cells = tr.cells;
    if (cells.length < 4) return; // Skip if not a standard row
    const index = Array.from(cells).indexOf(td);
    if (index === 1) { // First quantity column
      cells[0].innerHTML = '';
      cells[1].innerHTML = '';
    } else if (index === 3) { // Second quantity column
      cells[2].innerHTML = '';
      cells[3].innerHTML = '';
    }
    // If both sides are empty, remove the row
    if (!cells[0].innerHTML.trim() && !cells[1].innerHTML.trim() && !cells[2].innerHTML.trim() && !cells[3].innerHTML.trim()) {
      tr.remove();
    }
  }

  function escapeHtml(text){
    return text.replace(/[&<>"']/g, (c)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]));
  }
  // Sanitize and validation helpers for item names
  function sanitizeName(s){
    return (s||'').replace(/[^A-Za-z0-9\s\-\$\$\.,'"&\/]/g,'').trim();
  }
  function isValidName(s){
    return /^[A-Za-z0-9\s\-\$\$\.,'"&\/]+$/.test(s||'');
  }
  function showError(msg){ const el = document.getElementById('nameError'); if(el){ el.textContent = msg; el.style.display = 'block'; }}
  function clearError(){ const el = document.getElementById('nameError'); if(el){ el.textContent = ''; el.style.display = 'none'; }}
  function showTempMessage(msg){ const el = document.getElementById('nameError'); if(el){ el.textContent = msg; el.style.display = 'block'; setTimeout(()=>clearError(),2000); }}

  const nameInputEl = document.getElementById('newItemName');
  nameInputEl.addEventListener('input', (e)=>{
    const before = e.target.value;
    const sanitized = sanitizeName(before);
    if(before !== sanitized){ e.target.value = sanitized; showTempMessage('Removed invalid characters'); }
  });

  nameInputEl.addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ addBtn.click(); }});

  // Save TXT (original behavior, robust)
  saveTxt.addEventListener('click', ()=>{
    const rows = Array.from(tbody.querySelectorAll('tr'));
    const lines = rows.map(r=>{
      const name = r.cells[0]?.innerText?.trim() || '';
      const input = r.querySelector('input[type="number"]');
      const qty = input ? input.value : '';
      return name ? `${name}: ${qty}` : null;
    }).filter(Boolean);
    const blob = new Blob([lines.join('\n')], {type: 'text/plain'});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'inventory.txt';
    link.click();
  });

  // Export PNG
  exportPng.addEventListener('click', ()=>{
    const area = document.getElementById('exportArea');
    html2canvas(area, {scale:2}).then(canvas=>{
      const url = canvas.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = url; a.download = 'menu.png'; a.click();
    }).catch(err=>alert('Export failed: '+err));
  });

  // Export PDF using jsPDF
  exportPdf.addEventListener('click', async ()=>{
    const area = document.getElementById('exportArea');
    try{
      const canvas = await html2canvas(area, {scale:2});
      const imgData = canvas.toDataURL('image/png');
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ orientation: 'portrait', unit: 'pt', format: 'a4' });
      const pageWidth = pdf.internal.pageSize.getWidth();
      const pageHeight = pdf.internal.pageSize.getHeight();

      // calculate image dimensions to fit A4 while keeping ratio
      const imgWidth = pageWidth - 40; // margin
      const imgHeight = (canvas.height * imgWidth) / canvas.width;
      let y = 20;
      pdf.addImage(imgData, 'PNG', 20, y, imgWidth, imgHeight);
      pdf.save('menu.pdf');
    }catch(e){alert('PDF export failed: '+e)}
  });

  // Improve keyboard accessibility: Enter to add
  document.getElementById('newItemName').addEventListener('keydown', (e)=>{if(e.key==='Enter'){addBtn.click()}});

  // initial accessibility: ensure focusable buttons
  document.querySelectorAll('button').forEach(b=>b.setAttribute('tabindex','0'));


/* ===== LANGUAGE ===== */
const T={
  en:{
    name:"STARTER FACTORY",
    address:"Old Berhampur, Radhakanta Street, Berhampur",
    phone:"üìû 9938618356 | 9658216341",
    deals:"Deals in: Starters, Chinese, Tandoori, South Indian, Pendir",
    menu:"Menu"
  },
  hi:{
    name:"‡§∏‡•ç‡§ü‡§æ‡§∞‡•ç‡§ü‡§∞ ‡§´‡•à‡§ï‡•ç‡§ü‡§∞‡•Ä",
    address:"‡§ì‡§≤‡•ç‡§° ‡§¨‡§π‡§∞‡§æ‡§Æ‡§™‡•Å‡§∞, ‡§∞‡§æ‡§ß‡§æ‡§ï‡§æ‡§®‡•ç‡§§‡§æ ‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä‡§ü, ‡§¨‡§π‡§∞‡§æ‡§Æ‡§™‡•Å‡§∞",
    phone:"üìû 9938618356 | 9658216341",
    deals:"‡§∏‡•ç‡§ü‡§æ‡§∞‡•ç‡§ü‡§∞, ‡§ö‡§æ‡§á‡§®‡•Ä‡§ú‡§º, ‡§§‡§Ç‡§¶‡•Ç‡§∞‡•Ä, ‡§∏‡§æ‡§â‡§• ‡§á‡§Ç‡§°‡§ø‡§Ø‡§®",
    menu:"‡§Æ‡•á‡§®‡•Ç"
  },
  or:{
    name:"STARTER FACTORY",
    address:"Old Berhampur, Radhakanta Street, Berhampur",
    phone:"üìû 9938618356 | 9658216341",
    deals:"Starters, Chinese, Tandoori, South Indian",
    menu:"‡¨Æ‡≠á‡¨®‡≠Å"
  }
};

document.getElementById("langSelect").addEventListener("change",e=>{
  const L=T[e.target.value];
  headerName.textContent=L.name;
  headerAddress.textContent=L.address;
  headerPhone.textContent=L.phone;
  headerDealsIn.textContent=L.deals;
  menuTitle.textContent=L.menu;
});
</script>

</body>
</html>